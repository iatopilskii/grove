# Progress Log

## 2026-01-31

### UI-001: BubbleTea Framework Setup (COMPLETED)

**Task**: Application uses BubbleTea framework with Elm architecture (Model, Update, View pattern)

**Implementation**:
- Initialized Go module: `github.com/ilatopilskij/gwt`
- Added dependencies: bubbletea, lipgloss, bubbles
- Created project structure: `cmd/gwt/main.go`, `internal/ui/app.go`
- Implemented `App` struct implementing `tea.Model` interface
- Created `NewApp()` constructor
- Implemented `Init()`, `Update()`, `View()` methods
- Added quit handling for Ctrl+C and 'q' key

**Verification Steps Passed**:
- [x] main.go initializes bubbletea.Program
- [x] App struct implements tea.Model interface
- [x] Init(), Update(), View() methods exist
- [x] App compiles without errors

**Tests**:
- `TestAppImplementsTeaModel` - verifies interface compliance
- `TestNewApp` - verifies constructor
- `TestAppInit` - verifies Init() returns valid command
- `TestAppUpdate` - table-driven tests for message handling
- `TestAppUpdateQuitCommand` - verifies quit commands work
- `TestAppView` - verifies View() returns non-empty string

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All tests pass
go vet ./...        # No issues
go mod tidy         # Dependencies clean
```

### UI-002: Tabbed Navigation Bar (COMPLETED)

**Task**: Tabbed navigation bar at top with at least 3 tabs: Worktrees, Branches, Settings

**Implementation**:
- Created `internal/ui/tabs.go` with Tab model component
- Implemented `Tab` type with constants: `TabWorktrees`, `TabBranches`, `TabSettings`
- Created `Tabs` struct for managing tab bar state
- Implemented Tab/Shift+Tab keyboard navigation with wrap-around
- Added visual styling with lipgloss.AdaptiveColor for light/dark mode support
- Active tab is highlighted with background color and bold text
- Inactive tabs have muted foreground color
- Border line below tab bar for visual separation
- Integrated tabs into main App component
- Content area updates dynamically based on active tab

**Verification Steps Passed**:
- [x] Tab bar renders at top of screen
- [x] Tab/Shift+Tab cycles through tabs
- [x] Active tab is visually highlighted
- [x] Content area updates when tab changes

**Tests** (tabs_test.go):
- `TestTabString` - verifies tab display names
- `TestNewTabs` - verifies constructor and default active tab
- `TestTabsActive` - verifies Active() returns current tab
- `TestTabsSetActive` - table-driven tests for SetActive with bounds checking
- `TestTabsNext` - verifies forward cycling with wrap-around
- `TestTabsPrev` - verifies backward cycling with wrap-around
- `TestTabsUpdateTabKey` - verifies Tab key navigation
- `TestTabsUpdateShiftTabKey` - verifies Shift+Tab navigation
- `TestTabsUpdateOtherKeys` - verifies other keys don't affect tabs
- `TestTabsView` - verifies View() output
- `TestTabsViewContainsBorder` - verifies border rendering
- `TestTabsViewUpdatesWithActiveTab` - verifies styling changes per tab
- `TestTabsSetWidth` - verifies width setting

**Tests** (app_test.go - new):
- `TestAppViewContainsTabs` - verifies all tab names in view
- `TestAppViewShowsActiveTabContent` - table-driven content verification
- `TestAppUpdateTabKey` - verifies Tab key in App
- `TestAppUpdateShiftTabKey` - verifies Shift+Tab in App
- `TestAppUpdateWindowSize` - verifies window resize handling
- `TestAppTabCycling` - verifies full tab cycle

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 31 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### UI-003: Two-Pane Layout (COMPLETED)

**Task**: Two-pane layout: list view (top/left) and details view (bottom/right)

**Implementation**:
- Created `internal/ui/list.go` with List component for displaying scrollable items
- Created `internal/ui/details.go` with Details component for showing item information
- Implemented `ListItem` struct with ID, Title, and Description fields
- List component features:
  - Up/Down arrow key navigation
  - Vim-style j/k navigation
  - Selection indicator (▸) for current item
  - Bounds checking (stops at boundaries, no wrap)
  - Adaptive styling for light/dark mode
- Details component features:
  - Rounded border using lipgloss
  - Displays item title (bold) and description
  - Placeholder text when no item selected
  - Adaptive colors for light/dark mode
- Integrated both components into App:
  - Side-by-side layout (40% list, 60% details)
  - Selection in list updates details pane
  - Window size updates propagate to pane sizes
  - Navigation works on Worktrees and Branches tabs

**Verification Steps Passed**:
- [x] List pane shows scrollable items
- [x] Details pane shows info for selected item
- [x] Selection in list updates details pane
- [x] Both panes render within terminal bounds

**Tests** (list_test.go):
- `TestNewList` - verifies constructor with items
- `TestNewListEmpty` - verifies constructor with nil
- `TestListSelected` - verifies Selected() getter
- `TestListSetSelected` - table-driven bounds checking tests
- `TestListMoveDown` - verifies down navigation with boundary stop
- `TestListMoveUp` - verifies up navigation with boundary stop
- `TestListMoveDownEmpty` / `TestListMoveUpEmpty` - empty list handling
- `TestListSelectedItem` - verifies SelectedItem() getter
- `TestListSelectedItemEmpty` - nil return for empty list
- `TestListUpdateArrowKeys` - arrow key message handling
- `TestListUpdateJKKeys` - vim-style j/k navigation
- `TestListSetSize` - dimension setting
- `TestListViewShowsItems` - items appear in view
- `TestListViewHighlightsSelected` - selection changes view
- `TestListViewEmptyMessage` - empty list shows message
- `TestListItems` / `TestListSetItems` - items getter/setter
- `TestListSetItemsResetsSelection` - selection clamps on new items

**Tests** (details_test.go):
- `TestNewDetails` - verifies constructor
- `TestDetailsSetItem` / `TestDetailsSetItemNil` - item setting
- `TestDetailsSetSize` - dimension setting
- `TestDetailsViewEmpty` - placeholder for no item
- `TestDetailsViewShowsTitle` - title appears in view
- `TestDetailsViewShowsDescription` - description appears
- `TestDetailsViewUpdatesWithItem` - view changes with item
- `TestDetailsViewWithBorder` - border characters present
- `TestDetailsItem` - item getter

**Tests** (app_test.go - additions):
- `TestAppHasList` - verifies App has list component
- `TestAppHasDetails` - verifies App has details component
- `TestAppViewShowsList` - list selection indicator in view
- `TestAppViewShowsDetails` - details border in view
- `TestAppListNavigationDown` - arrow down moves selection
- `TestAppListNavigationUp` - arrow up moves selection
- `TestAppDetailsUpdatesWithSelection` - details sync with list
- `TestAppViewRendersBothPanes` - multi-line layout verification

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 84 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### NAV-001: Arrow Key Navigation in List Views (COMPLETED)

**Task**: Arrow key navigation in list views with Page Up/Down support

**Implementation**:
- Added `PageDown()` method to List component - moves selection down by page size (based on visible height)
- Added `PageUp()` method to List component - moves selection up by page size
- Both methods handle edge cases: empty list, zero height (fallback to 1), and boundary clamping
- Updated List's `Update()` method to handle `tea.KeyPgDown` and `tea.KeyPgUp` messages
- Updated App's `Update()` method to route PageUp/PageDown keys to list on Worktrees/Branches tabs
- Updated help text to include PgUp/PgDn navigation hint

**Verification Steps Passed**:
- [x] Up/Down arrows move selection cursor (already implemented)
- [x] Selection wraps or stops at boundaries (stops at boundaries)
- [x] Current selection is visually distinct (▸ indicator with background color)
- [x] Page Up/Down scroll by page

**Tests** (list_test.go - new tests):
- `TestListPageDown` - verifies page-based navigation with boundary clamping
- `TestListPageUp` - verifies page-based navigation with boundary clamping
- `TestListPageDownEmpty` - verifies empty list doesn't panic
- `TestListPageUpEmpty` - verifies empty list doesn't panic
- `TestListPageDownZeroHeight` - verifies fallback page size of 1
- `TestListPageUpZeroHeight` - verifies fallback page size of 1
- `TestListUpdatePageKeys` - verifies KeyPgDown/KeyPgUp message handling

**Tests** (app_test.go - new tests):
- `TestAppListNavigationPageDown` - verifies App routes PageDown to list
- `TestAppListNavigationPageUp` - verifies App routes PageUp to list
- `TestAppPageNavigationUpdatesDetails` - verifies details pane updates after page navigation
- `TestAppPageNavigationOnlyOnListTabs` - verifies page navigation only works on list tabs

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 93 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### NAV-002: Mouse Support for Selection and Scrolling (COMPLETED)

**Task**: Mouse support for selection and scrolling

**Implementation**:
- Added mouse event handling to `Init()` with `tea.EnableMouseCellMotion`
- Extended `List` struct with `offsetX` and `offsetY` fields for screen position tracking
- Added `SetOffset(x, y)` method to List for setting screen position
- Added `IsInBounds(x, y)` method to List for checking if mouse coordinates are within list bounds
- Added mouse left-click handling in `List.Update()` to select items based on click position
- Added mouse wheel up/down handling in `List.Update()` for scrolling (moves selection)
- Created `TabPosition` struct to track tab positions on screen
- Added `GetTabPositions()` method to Tabs for calculating tab screen coordinates
- Added mouse left-click handling in `Tabs.Update()` to switch tabs when clicking on them
- Updated `App.Update()` to route mouse events to appropriate components
- Updated `App.updatePaneSizes()` to set list offset for mouse coordinate calculation
- Mouse clicks outside bounds are safely ignored (no crash)
- Mouse events only affect list when on Worktrees or Branches tabs

**Verification Steps Passed**:
- [x] Click on list item selects it
- [x] Mouse scroll works in list and details panes
- [x] Click on tab switches to that tab
- [x] No crash on mouse events outside bounds

**Tests** (list_test.go - new tests):
- `TestListMouseClickSelect` - verifies clicking on list item selects it
- `TestListMouseClickOutOfBounds` - verifies clicking outside list doesn't crash
- `TestListMouseClickEmpty` - verifies clicking on empty list doesn't crash
- `TestListMouseWheelDown` - verifies mouse wheel scrolls down
- `TestListMouseWheelUp` - verifies mouse wheel scrolls up
- `TestListMouseWheelEmpty` - verifies mouse wheel on empty list doesn't crash
- `TestListSetOffset` - verifies SetOffset sets position correctly
- `TestListIsInBounds` - table-driven tests for bounds checking

**Tests** (tabs_test.go - new tests):
- `TestTabsMouseClickSwitchTab` - verifies clicking on tab switches to it
- `TestTabsMouseClickOutOfBounds` - verifies clicking outside tabs doesn't crash
- `TestTabsGetTabPositions` - verifies GetTabPositions returns correct positions

**Tests** (app_test.go - new tests):
- `TestAppMouseClickListItem` - verifies clicking on list item via App
- `TestAppMouseClickTab` - verifies clicking on tab via App
- `TestAppMouseWheelInList` - verifies mouse wheel scrolls list via App
- `TestAppMouseOutsideBounds` - verifies clicking outside bounds doesn't crash
- `TestAppMouseDetailsPane` - verifies clicking on details pane doesn't change list selection
- `TestAppMouseDetailsUpdateAfterClick` - verifies details updates after mouse selection
- `TestAppMouseOnSettingsTab` - verifies mouse doesn't affect list on Settings tab

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 121 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### NAV-003: Enter Key Triggers Action on Selected Item (COMPLETED)

**Task**: Enter key triggers action on selected item

**Implementation**:
- Created `internal/ui/actionmenu.go` with ActionMenu component for displaying available actions
- Created `internal/ui/feedback.go` with Feedback component for showing success/error/info messages
- ActionMenu features:
  - Modal dialog that appears when Enter is pressed on a worktree
  - Displays available actions: Open, Copy Path, Delete
  - Up/Down arrow and j/k keys for navigation
  - Enter key executes selected action
  - Escape key cancels and closes the menu
  - Visual styling with selection indicator (▸)
  - Help text showing available keyboard shortcuts
- Feedback component features:
  - Shows temporary feedback messages (auto-clears after 3 seconds)
  - Three types: Success (✓), Error (✗), Info (ℹ)
  - Adaptive colors for light/dark terminal modes
  - ClearFeedbackMsg for programmatic clearing
- App integration:
  - Enter key opens ActionMenu on Worktrees and Branches tabs
  - Escape key closes ActionMenu when visible
  - All key events routed to ActionMenu when visible
  - ActionExecutedMsg triggers action handling and feedback display
  - Ctrl+C still quits even with menu open
  - Help text updated to include Enter key hint

**Verification Steps Passed**:
- [x] Enter on worktree opens action menu or executes default action
- [x] Action feedback shown (success/error message)
- [x] Escape cancels action dialogs

**Tests** (actionmenu_test.go - 24 tests):
- `TestNewActionMenu` - verifies constructor
- `TestActionMenuShow` - verifies Show makes menu visible
- `TestActionMenuHide` - verifies Hide closes menu
- `TestActionMenuMoveDown` / `TestActionMenuMoveUp` - navigation
- `TestActionMenuMoveDownAtBoundary` / `TestActionMenuMoveUpAtBoundary` - boundary behavior
- `TestActionMenuMoveDownEmpty` / `TestActionMenuMoveUpEmpty` - empty list handling
- `TestActionMenuSelectedAction` / `TestActionMenuSelectedActionEmpty` - selection getters
- `TestActionMenuSetActions` / `TestActionMenuSetActionsClampsSelection` - action management
- `TestActionMenuUpdateEscape` - Escape key closes menu
- `TestActionMenuUpdateArrowKeys` - arrow key navigation
- `TestActionMenuUpdateJKKeys` - vim-style navigation
- `TestActionMenuUpdateEnter` - Enter executes action
- `TestActionMenuUpdateWhenHidden` - hidden state handling
- `TestActionMenuView` / `TestActionMenuViewWhenHidden` - rendering
- `TestActionMenuViewShowsSelectedDescription` - description display
- `TestDefaultWorktreeActions` - default actions verification
- `TestActionMenuSetSize` - dimension setting

**Tests** (feedback_test.go - 15 tests):
- `TestNewFeedback` - verifies constructor
- `TestFeedbackShowSuccess` / `TestFeedbackShowError` / `TestFeedbackShowInfo` - message types
- `TestFeedbackClear` - manual clearing
- `TestFeedbackUpdateClearMsg` - message-based clearing
- `TestFeedbackSetDuration` - duration configuration
- `TestFeedbackViewSuccess` / `TestFeedbackViewError` / `TestFeedbackViewInfo` - rendering
- `TestFeedbackViewWhenHidden` / `TestFeedbackViewAfterClear` - hidden state
- `TestFeedbackTypeConstants` - type distinctness

**Tests** (app_test.go - 18 new tests):
- `TestAppHasActionMenu` / `TestAppHasFeedback` - component existence
- `TestAppEnterOpensActionMenu` / `TestAppEnterOpensActionMenuOnBranchesTab` - Enter key
- `TestAppEnterDoesNotOpenOnSettingsTab` - tab restriction
- `TestAppEscapeClosesActionMenu` - Escape handling
- `TestAppActionMenuRoutesKeys` - key routing when menu visible
- `TestAppActionMenuEnterExecutesAction` - action execution
- `TestAppActionExecutedShowsFeedback` - feedback integration
- `TestAppCtrlCQuitsEvenWithMenuOpen` - quit override
- `TestAppViewShowsActionMenu` / `TestAppViewShowsFeedback` - view integration
- `TestAppViewHelpIncludesEnter` - help text update
- `TestAppClearFeedbackMsg` - feedback clearing
- `TestAppActionMenuJKNavigation` - vim keys in menu
- `TestAppEnterWithEmptyList` - empty list handling
- `TestAppHandleActionExecutedOpen` / `TestAppHandleActionExecutedDelete` / `TestAppHandleActionExecutedUnknown` / `TestAppHandleActionExecutedNilAction` - action handlers

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 178 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### STYLE-001: Adaptive Color Scheme (COMPLETED)

**Task**: Adaptive color scheme detects terminal light/dark mode

**Implementation**:
- Verified all existing UI components already use `lipgloss.AdaptiveColor` for colors
- Created `internal/ui/styles.go` with centralized color palette and reusable styles
- All colors define both Light and Dark variants for automatic terminal theme adaptation
- Color palette includes:
  - Primary colors (purple accent for active/selected states)
  - Text colors (dark in light mode, light in dark mode)
  - Border colors (matches primary)
  - Semantic colors (Success/green, Error/red, Info/blue) with proper contrast
- No hardcoded ANSI escape codes found in codebase

**Verification Steps Passed**:
- [x] App uses lipgloss.AdaptiveColor for all colors
- [x] Light terminal shows dark text on light background
- [x] Dark terminal shows light text on dark background
- [x] No hardcoded ANSI color codes

**Tests** (styles_test.go):
- `TestColorsUseAdaptiveColor` - verifies all palette colors have Light and Dark values
- `TestColorContrastLightMode` - verifies light mode uses dark text colors
- `TestColorContrastDarkMode` - verifies dark mode uses light text colors
- `TestSemanticColorsHaveContrast` - verifies On* colors are white for contrast
- `TestStylesExist` - verifies predefined styles render without panic
- `TestNoHardcodedANSI` - verifies styles render non-empty output

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 184 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### STYLE-002: Minimal and Clean Visual Design (COMPLETED)

**Task**: Minimal and clean visual design with thin borders, consistent padding, and subtle focus indicator

**Implementation**:
- Extended `internal/ui/styles.go` with centralized styling constants:
  - `Borders` struct with `Thin` (NormalBorder) and `Rounded` (RoundedBorder) for single-line box drawing
  - `Padding` struct with `None` (0), `Small` (1), `Medium` (2) for consistent spacing
  - `FocusIndicator` struct with `Symbol` (▸) and `SymbolInactive` (whitespace) for subtle selection
  - `Styles.ListItem` with `Selected` and `Normal` styles using text color instead of background
  - `Styles.Box` for bordered containers using thin rounded corners
- Updated `list.go` to use centralized `Styles.ListItem` and `FocusIndicator`:
  - Focus indicator is now subtle: primary color text with ▸ symbol (no background)
  - Consistent padding using `FocusIndicator.Symbol` width calculation
- Updated `details.go` to use centralized `Styles.Box`:
  - Uses thin rounded border from `Borders.Rounded`
  - Consistent colors from `Colors` palette
- Updated `actionmenu.go` to use centralized styles:
  - Uses `Styles.ListItem` for action items
  - Uses `FocusIndicator` for selection indicator
  - Uses `Styles.Box` with consistent padding
- Updated `tabs.go` to use centralized styles:
  - Active tab uses primary color text (no background) for subtle indication
  - Thin border using `Borders.Thin.Bottom` character
  - Consistent padding from `Padding.Medium`
- Updated `app.go` to use `Styles.Help` for help text

**Verification Steps Passed**:
- [x] Borders are thin (single-line box drawing) - uses lipgloss.NormalBorder() and RoundedBorder()
- [x] No excessive decorations or ASCII art - clean, minimal styling
- [x] Consistent padding/margins - centralized Padding constants used throughout
- [x] Focus indicator is subtle but visible - ▸ symbol with primary color text (no background)

**Tests** (styles_test.go - new tests):
- `TestBordersAreThin` - verifies Borders.Thin uses single-line characters (─│┌┐└┘)
- `TestBordersRoundedIsThin` - verifies Borders.Rounded uses thin rounded corners (╭╮)
- `TestPaddingConstants` - verifies Padding.None=0, Small=1, Medium=2
- `TestFocusIndicatorStyle` - verifies focus symbols have same visual width
- `TestStylesListItemHasConsistentPadding` - verifies list item styles render correctly
- `TestBoxStyleUsesThinBorder` - verifies Styles.Box renders with border
- `TestNoExcessiveDecorations` - verifies Help and Muted styles are simple

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 191 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### STYLE-003: User-Configurable Theme via Config File (COMPLETED)

**Task**: User-configurable theme via config file (~/.config/gwt/theme.yaml)

**Implementation**:
- Created `internal/config/config.go` with complete configuration handling
- Defined `Config` struct hierarchy: `Config` → `Theme` → `ThemeColors` → `AdaptiveColor`
- `AdaptiveColor` struct with `Light` and `Dark` fields matching lipgloss.AdaptiveColor
- `DefaultConfig()` returns built-in default color scheme
- `DefaultConfigPath()` returns XDG-compliant path: `~/.config/gwt/theme.yaml`
- `LoadConfig(path)` loads YAML, falls back to defaults for missing file or invalid values
- Partial config support: unspecified colors inherit defaults via `mergeConfig()`
- `GenerateSampleConfig()` produces documented YAML with all color options and comments
- `WriteSampleConfig(path)` creates sample config file, creating directories as needed
- Added `gopkg.in/yaml.v3` dependency for YAML parsing
- Extended `internal/ui/styles.go` with theme integration:
  - `configToAdaptive()` converts config.AdaptiveColor to lipgloss.AdaptiveColor
  - `ApplyThemeConfig(cfg)` updates global Colors and rebuilds Styles
  - `rebuildStyles()` recreates all lipgloss.Style instances with current Colors
  - `LoadAndApplyTheme()` convenience function for startup (loads from default path)
- Updated `cmd/gwt/main.go` to call `LoadAndApplyTheme()` at startup
  - Prints warning to stderr if config has errors (but still uses defaults)

**Verification Steps Passed**:
- [x] Config file (~/.config/gwt/theme.yaml) is read on startup
- [x] Colors defined in config override defaults
- [x] Invalid config values fall back to defaults
- [x] Sample config documented or generated (via GenerateSampleConfig/WriteSampleConfig)

**Tests** (config_test.go - 10 tests):
- `TestDefaultConfig` - verifies default config has all color values
- `TestDefaultConfigPath` - verifies XDG-compliant path returned
- `TestLoadConfigNoFile` - verifies missing file returns defaults without error
- `TestLoadConfigValidYAML` - verifies complete YAML config loads correctly
- `TestLoadConfigPartialYAML` - verifies partial config merges with defaults
- `TestLoadConfigInvalidYAML` - verifies invalid YAML returns defaults with error
- `TestLoadConfigMalformedColors` - verifies malformed values load as-is
- `TestAdaptiveColorHasLightAndDark` - table-driven test for all color fields
- `TestGenerateSampleConfig` - verifies sample config contains all sections
- `TestWriteSampleConfig` - verifies sample file is written and loadable

**Tests** (styles_test.go - new tests):
- `TestApplyThemeConfigUpdatesColors` - verifies Colors updated after ApplyThemeConfig
- `TestApplyThemeConfigUpdatesAllColors` - table-driven test for all color updates
- `TestApplyThemeConfigRebuildStyles` - verifies Styles rebuilt after config applied
- `TestLoadAndApplyThemeNoFile` - verifies LoadAndApplyTheme works without config file
- `TestConfigToAdaptive` - verifies configToAdaptive conversion

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All tests pass (config: 10, ui: expanded)
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-002: Create New Worktree from Existing or New Branch (COMPLETED)

**Task**: Create new worktree from existing or new branch

**Implementation**:
- Extended `internal/git/worktree.go` with worktree creation functions:
  - `AddWorktreeOptions` struct with Path, Branch, CreateBranch, BaseBranch fields
  - `AddWorktree(dir, opts)` creates new worktree via `git worktree add`
  - Supports creating new branches with `-b` flag
  - Supports using existing branches
  - `WorktreeAddError` for descriptive error messages
  - `ListBranches(dir)` lists all local branches
- Created `internal/ui/createform.go` with CreateForm modal component:
  - Three fields: branch name, worktree path, create new branch checkbox
  - Tab/Shift+Tab navigation between fields
  - Left/Right arrow key cursor movement in text fields
  - Space key toggles checkbox
  - Enter key validates and submits form
  - Escape key cancels and closes form
  - Validation: requires branch name and path
  - Error message display for invalid input
  - Visual cursor indicator in focused text fields
- Integrated CreateForm into App:
  - Press 'n' on Worktrees tab opens create form
  - Form only opens when in a valid git repository
  - CreateFormSubmittedMsg triggers `git.AddWorktree()`
  - Success/error feedback shown via Feedback component
  - Worktree list refreshes automatically after creation
  - CreateFormCancelledMsg handled (form closes, no action)
- Updated help text to include 'n: new worktree'
- Ctrl+C quits even with create form open

**Verification Steps Passed**:
- [x] User can input branch name and path (form with two text fields)
- [x] Worktree created via git worktree add (uses AddWorktree function)
- [x] New worktree appears in list after creation (loadWorktrees called on success)
- [x] Error shown if branch/path invalid (validation + git error feedback)

**Tests** (worktree_test.go - new tests):
- `TestWorktreeAddError` - verifies error type and message
- `TestAddWorktreeOptions` - verifies options struct fields
- `TestAddWorktreeInNonGitDir` - verifies NotGitRepoError for non-git directory
- `TestAddWorktreeEmptyPath` - verifies path is required
- `TestAddWorktreeNoBranchWithoutCreate` - verifies branch required when not creating
- `TestAddWorktreeIntegration` - integration test creating worktree with new branch
- `TestAddWorktreeWithExistingBranch` - integration test with existing branch
- `TestListBranchesInNonGitDir` - verifies error for non-git directory
- `TestListBranchesIntegration` - integration test listing branches

**Tests** (createform_test.go - 32 tests):
- `TestNewCreateForm` - verifies constructor
- `TestCreateFormShow` - verifies Show resets fields and makes visible
- `TestCreateFormHide` - verifies Hide closes form
- `TestCreateFormSetSize` - verifies dimension setting
- `TestCreateFormSetError` - verifies error setting
- `TestCreateFormFocusNext` - verifies Tab navigation with wrap
- `TestCreateFormFocusPrev` - verifies Shift+Tab navigation with wrap
- `TestCreateFormInsertChar` - verifies character insertion
- `TestCreateFormDeleteChar` - verifies backspace
- `TestCreateFormValidate` - table-driven validation tests
- `TestCreateFormUpdateEscape` - verifies Escape closes form
- `TestCreateFormUpdateTab` - verifies Tab key navigation
- `TestCreateFormUpdateBackspace` - verifies backspace handling
- `TestCreateFormUpdateArrows` - verifies cursor movement
- `TestCreateFormUpdateSpace` - verifies checkbox toggle
- `TestCreateFormUpdateRunes` - verifies character input
- `TestCreateFormUpdateEnterValid` - verifies valid submission
- `TestCreateFormUpdateEnterInvalid` - verifies invalid shows error
- `TestCreateFormUpdateWhenHidden` - verifies no action when hidden
- `TestCreateFormView` - verifies view renders correctly
- `TestCreateFormViewWhenHidden` - verifies empty when hidden
- `TestCreateFormViewShowsError` - verifies error display
- `TestCreateFormViewCheckboxState` - verifies checkbox rendering
- `TestCreateFormRenderInputWithCursor` - table-driven cursor rendering tests
- `TestCreateFormFieldConstants` - verifies field constants are distinct

**Tests** (app_test.go - new tests):
- `TestAppHasCreateForm` - verifies App has createForm component
- `TestAppNKeyOpensCreateForm` - verifies 'n' opens form on Worktrees tab
- `TestAppNKeyDoesNotOpenOnNonWorktreesTabs` - verifies 'n' only works on Worktrees
- `TestAppNKeyDoesNotOpenOnGitError` - verifies 'n' disabled when not in git repo
- `TestAppCreateFormRoutesKeys` - verifies keys routed to form when visible
- `TestAppCreateFormEscapeCloses` - verifies Escape closes form
- `TestAppCtrlCQuitsEvenWithFormOpen` - verifies Ctrl+C override
- `TestAppViewShowsCreateForm` - verifies form appears in view
- `TestAppViewHelpIncludesNewKey` - verifies help text update
- `TestAppCreateFormCancelledMsg` - verifies cancel message handled
- `TestAppCreateFormSubmittedSuccess` - verifies form submission
- `TestAppCreateFormTabNavigation` - verifies Tab in form

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-001: List All Git Worktrees in Current Repository (COMPLETED)

**Task**: List all git worktrees in current repository

**Implementation**:
- Created `internal/git/worktree.go` with git worktree operations
- Defined `Worktree` struct with fields: Path, Branch, CommitHash, IsBare, IsDetached
- Implemented `Name()` method to get worktree name from path
- Created `NotGitRepoError` for non-git directory handling with `IsNotGitRepoError()` helper
- Implemented `IsGitRepository(dir)` to check if directory is in a git repo
- Implemented `GetCurrentDirectory()` helper to get current working directory
- Implemented `ListWorktrees(dir)` to list all worktrees using `git worktree list`
- Implemented `ParseWorktreeList(output)` to parse git command output
- Handles multiple output formats: regular worktrees, bare repos, detached HEAD
- Extended `App` struct with worktrees, gitError, and repoPath fields
- Created `NewAppWithPath(path)` for specifying repository path
- Created `NewAppWithItems(items)` for testing with custom items
- Added `loadWorktrees()` method to load git worktrees and convert to ListItem
- Added `worktreeToListItem()` conversion function
- Added `Worktrees()`, `GitError()`, `IsInGitRepo()`, `RefreshWorktrees()` getters
- Added `renderGitError()` to display error message for non-git directories
- Updated `View()` to show error message when not in git repository
- Error display includes helpful message: "Not a Git Repository" with git init hint

**Verification Steps Passed**:
- [x] Running in git repo shows all worktrees
- [x] Each worktree shows: name, path, branch (in details pane)
- [x] Worktree list updates after create/delete (via RefreshWorktrees)
- [x] Error shown if not in git repo

**Tests** (worktree_test.go - 12 tests):
- `TestWorktreeFields` - verifies Worktree struct fields
- `TestWorktreeName` - verifies Name() returns last path component
- `TestParseWorktreeList` - table-driven parsing tests (6 sub-tests)
  - single worktree, multiple worktrees, bare repository, detached HEAD, empty, whitespace
- `TestIsGitRepository` - verifies git repo detection
- `TestListWorktreesInNonGitDir` - verifies error for non-git directory
- `TestListWorktreesIntegration` - integration test with real git repo
- `TestListWorktreesWithMultipleWorktrees` - tests listing multiple worktrees
- `TestNotGitRepoError` - verifies error type and message
- `TestGetCurrentDirectory` - verifies current directory getter

**Tests** (app_test.go - new tests):
- `TestNewAppWithItems` - verifies NewAppWithItems creates app with custom items
- `TestNewAppWithItemsInitializesDetails` - verifies details set for first item
- `TestNewAppWithEmptyItems` - verifies app works with empty items
- `TestAppWorktreesGetter` - verifies Worktrees() returns worktrees
- `TestAppGitErrorGetter` - verifies GitError() returns error state
- `TestAppIsInGitRepo` - verifies IsInGitRepo() works
- `TestAppRefreshWorktrees` - verifies RefreshWorktrees works
- `TestAppViewShowsGitError` - verifies View shows error for non-git directory
- `TestAppViewShowsWorktreeList` - verifies View shows worktree list in git repo

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 256 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-003: Delete/Remove Worktree (COMPLETED)

**Task**: Delete/remove worktree with confirmation prompt and force option

**Implementation**:
- Extended `internal/git/worktree.go` with worktree removal functions:
  - `WorktreeRemoveError` type for descriptive error messages
  - `RemoveWorktreeOptions` struct with Path and Force fields
  - `RemoveWorktree(dir, opts)` removes worktree via `git worktree remove`
  - Supports force removal with `--force` flag for uncommitted changes
  - `HasUncommittedChanges(path)` checks for uncommitted changes in worktree
- Created `internal/ui/confirm.go` with ConfirmDialog modal component:
  - Title, message, and optional danger mode (red styling)
  - Confirm/Cancel buttons with left/right arrow key navigation
  - Force checkbox option for worktree deletion
  - Tab/Shift+Tab and h/l vim-style navigation
  - Quick y/n keyboard shortcuts for confirmation
  - Space/f keys toggle force checkbox
  - Enter executes selected action, Escape cancels
  - `ConfirmDialogResultMsg` sent with Confirmed, Force, and Data fields
- Integrated ConfirmDialog into App:
  - Delete action in ActionMenu triggers confirmation dialog
  - Confirmation dialog has force option for uncommitted changes
  - ConfirmDialogResultMsg triggers `git.RemoveWorktree()`
  - Success/error feedback shown via Feedback component
  - Worktree list refreshes automatically after removal
  - Ctrl+C quits even with dialog open
  - All key events routed to dialog when visible

**Verification Steps Passed**:
- [x] Confirmation prompt before delete (ConfirmDialog with danger styling)
- [x] Worktree removed via git worktree remove (RemoveWorktree function)
- [x] Worktree disappears from list after removal (loadWorktrees called on success)
- [x] Error shown if worktree has uncommitted changes (or force option enabled)

**Tests** (worktree_test.go - new tests):
- `TestWorktreeRemoveError` - verifies error type and message
- `TestRemoveWorktreeOptions` - verifies options struct fields
- `TestRemoveWorktreeInNonGitDir` - verifies NotGitRepoError for non-git directory
- `TestRemoveWorktreeEmptyPath` - verifies path is required
- `TestRemoveWorktreeIntegration` - integration test removing worktree
- `TestRemoveWorktreeWithUncommittedChanges` - tests force option with uncommitted changes
- `TestHasUncommittedChangesInNonGitDir` - verifies error for non-git directory
- `TestHasUncommittedChangesIntegration` - integration test checking uncommitted changes

**Tests** (confirm_test.go - 27 tests):
- `TestNewConfirmDialog` - verifies constructor
- `TestConfirmDialogShow` - verifies Show makes dialog visible
- `TestConfirmDialogShowWithData` - verifies ShowWithData stores data
- `TestConfirmDialogShowDanger` - verifies ShowDanger sets danger mode
- `TestConfirmDialogHide` - verifies Hide closes dialog
- `TestConfirmDialogMoveLeft` / `TestConfirmDialogMoveRight` - navigation
- `TestConfirmDialogToggleForce` - verifies force toggle
- `TestConfirmDialogUpdateEscape` - verifies Escape closes dialog
- `TestConfirmDialogUpdateEnterConfirm` / `TestConfirmDialogUpdateEnterCancel` - Enter key
- `TestConfirmDialogUpdateArrowKeys` / `TestConfirmDialogUpdateTabKeys` - navigation keys
- `TestConfirmDialogUpdateHLKeys` - vim-style navigation
- `TestConfirmDialogUpdateYKey` / `TestConfirmDialogUpdateNKey` - quick y/n keys
- `TestConfirmDialogUpdateSpaceToggleForce` / `TestConfirmDialogUpdateFToggleForce` - force toggle
- `TestConfirmDialogUpdateWhenHidden` - verifies no action when hidden
- `TestConfirmDialogSetSize` - verifies dimension setting
- `TestConfirmDialogSetLabels` - verifies label setting
- `TestConfirmDialogView` / `TestConfirmDialogViewWhenHidden` - rendering tests
- `TestConfirmDialogViewWithForce` / `TestConfirmDialogViewForceChecked` - force checkbox rendering
- `TestConfirmDialogHasForceOption` - verifies HasForceOption getter
- `TestConfirmDialogForceWithEnter` - verifies force state passed on confirm

**Tests** (app_test.go - new tests):
- `TestAppHasConfirmDialog` - verifies App has confirmDialog component
- `TestAppConfirmDialogRoutesKeys` - verifies keys routed to dialog when visible
- `TestAppConfirmDialogEscapeCloses` - verifies Escape closes dialog
- `TestAppCtrlCQuitsEvenWithConfirmDialogOpen` - verifies Ctrl+C override
- `TestAppViewShowsConfirmDialog` - verifies dialog appears in view
- `TestAppConfirmDialogResultMsgCancelled` - verifies cancelled result handled
- `TestAppConfirmDialogResultMsgConfirmedNoData` - verifies confirmed without data
- `TestAppDeleteConfirmationFlow` - verifies complete delete confirmation flow
- `TestAppDeleteWithForceOption` - verifies force option in delete
- `TestAppConfirmDialogQuickAnswer` - verifies quick y/n answers
- `TestAppHandleActionExecutedDelete` (updated) - verifies delete shows confirmation dialog

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-004: Prune Stale Worktrees (COMPLETED)

**Task**: Prune stale worktrees via git worktree prune with UI integration

**Implementation**:
- Extended `internal/git/worktree.go` with prune functions:
  - `WorktreePruneError` type for descriptive error messages
  - `PruneWorktrees(dir)` removes stale worktree entries via `git worktree prune`
  - `PruneWorktreesDryRun(dir)` shows which worktrees would be pruned without removing
  - Both functions return output from git command for feedback
- Added 'p' keyboard shortcut on Worktrees tab to trigger prune:
  - Shows confirmation dialog before pruning
  - Confirmation dialog explains what prune does
  - Only available when in a valid git repository
- Integrated prune into App:
  - `handleConfirmDialogResult` handles prune confirmation
  - On confirmation, calls `git.PruneWorktrees()`
  - Shows success/error feedback via Feedback component
  - Worktree list refreshes automatically after prune
  - Escape key cancels prune confirmation
  - Ctrl+C still quits even with dialog open
- Updated help text to include 'p: prune' hint

**Verification Steps Passed**:
- [x] Prune option available in UI ('p' keyboard shortcut)
- [x] Runs git worktree prune (via PruneWorktrees function)
- [x] Stale entries removed from list (loadWorktrees called after prune)
- [x] Feedback message shown after prune (via Feedback component)

**Tests** (worktree_test.go - 5 new tests):
- `TestWorktreePruneError` - verifies error type and message
- `TestPruneWorktreesInNonGitDir` - verifies NotGitRepoError for non-git directory
- `TestPruneWorktreesIntegration` - integration test pruning clean repo
- `TestPruneWorktreesWithStaleEntry` - integration test pruning stale worktree
- `TestPruneWorktreesDryRun` - tests dry-run mode

**Tests** (app_test.go - 8 new tests):
- `TestAppPKeyTriggersPrune` - verifies 'p' opens prune confirmation on Worktrees tab
- `TestAppPKeyDoesNotTriggerOnSettingsTab` - verifies 'p' doesn't work on Settings tab
- `TestAppPruneConfirmationFlow` - verifies prune confirmation flow
- `TestAppPruneCancellation` - verifies prune can be cancelled with Escape
- `TestAppViewHelpIncludesPrune` - verifies help text includes 'p: prune' hint
- `TestAppPruneResultMsg` - verifies handling of prune result message
- `TestAppPKeyDoesNotTriggerWhenGitError` - verifies 'p' doesn't work when not in git repo

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 370 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-005: Show Worktree Details (COMPLETED)

**Task**: Show worktree details: path, branch, status with modified/staged file counts

**Implementation**:
- Extended `internal/git/worktree.go` with status functions:
  - `WorktreeStatus` struct with `ModifiedCount`, `StagedCount`, `UntrackedCount` fields
  - `TotalChanges()` method returns sum of all changes
  - `IsClean()` method returns true if no changes
  - `GetWorktreeStatus(path)` retrieves status via `git status --porcelain`
  - `ParseWorktreeStatus(output)` parses porcelain format status output
- Extended `internal/ui/list.go` with metadata support:
  - `WorktreeItemData` struct holds worktree-specific data (path, branch, commit, status counts)
  - `ListItem.Metadata` field (interface{}) holds arbitrary item-specific data
- Updated `internal/ui/app.go` to populate metadata:
  - `worktreeToListItem()` now fetches status via `git.GetWorktreeStatus()`
  - Populates `WorktreeItemData` with path, branch, commit hash, and status counts
- Enhanced `internal/ui/details.go` to display rich worktree information:
  - `renderItemDetails()` method for structured detail rendering
  - Shows full path with label
  - Shows branch name (or "Bare repository" / "Detached HEAD" for special cases)
  - Shows commit hash for detached HEAD state
  - `renderStatusLine()` shows formatted status:
    - "✓ Clean" for worktrees with no changes
    - "X staged, Y modified, Z untracked" with color-coded counts
  - Staged files shown in green (success color)
  - Modified files shown in red (error color)
  - Untracked files shown in muted color
  - Falls back to simple description if no metadata

**Verification Steps Passed**:
- [x] Details pane shows full path (via WorktreeItemData.Path)
- [x] Details pane shows branch name (via WorktreeItemData.Branch)
- [x] Details pane shows modified/staged file count (via status line rendering)
- [x] Details update when selection changes (existing functionality preserved)

**Tests** (worktree_test.go - 7 new tests):
- `TestWorktreeStatusFields` - verifies WorktreeStatus struct fields and methods
- `TestWorktreeStatusIsClean` - table-driven tests for IsClean() method
- `TestParseWorktreeStatus` - table-driven tests for parsing porcelain output (10 sub-tests)
- `TestGetWorktreeStatusInNonGitDir` - verifies error for non-git directory
- `TestGetWorktreeStatusIntegration` - integration test with real git repo

**Tests** (details_test.go - 11 new tests):
- `TestDetailsViewWithWorktreeMetadata` - verifies metadata display
- `TestDetailsViewShowsCleanStatus` - verifies "Clean" status for no changes
- `TestDetailsViewShowsModifiedCount` - verifies modified count display
- `TestDetailsViewShowsStagedCount` - verifies staged count display
- `TestDetailsViewShowsUntrackedCount` - verifies untracked count display
- `TestDetailsViewShowsBareRepository` - verifies bare repository handling
- `TestDetailsViewShowsDetachedHead` - verifies detached HEAD display
- `TestDetailsViewFallbackToDescription` - verifies fallback without metadata
- `TestDetailsViewMultipleStatusCounts` - verifies combined status display

**Tests** (list_test.go - 3 new tests):
- `TestListItemWithMetadata` - verifies ListItem can hold WorktreeItemData
- `TestWorktreeItemDataFields` - verifies WorktreeItemData struct fields
- `TestListItemWithNilMetadata` - verifies ListItem works without metadata

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All 401 tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

### GIT-006: Switch to Worktree (COMPLETED)

**Task**: Switch to worktree (open in terminal or change directory)

**Implementation**:
- Created `internal/git/terminal.go` with terminal opening functionality:
  - `TerminalOpener` struct for managing terminal operations
  - `NewTerminalOpener()` constructor with auto-detection
  - `NewTerminalOpenerWithCmd(cmd)` constructor for custom terminal command
  - `OpenWorktree(path)` opens worktree in new terminal or provides cd command fallback
  - `OpenWorktreeResult` struct with Success, Method, Message, and CDCommand fields
  - `detectTerminal()` auto-detects available terminal based on OS
  - macOS support: iTerm2, Alacritty, Kitty, WezTerm, Terminal.app (using AppleScript)
  - Linux support: gnome-terminal, konsole, xfce4-terminal, alacritty, kitty, wezterm, terminator, xterm
  - Windows support: Windows Terminal (wt.exe), PowerShell, cmd.exe
  - `GetCDCommand(path)` helper returns shell cd command for fallback
  - `shellQuote(s)` safely quotes paths for shell commands
- Updated `internal/ui/app.go` to use terminal opener:
  - Open action now calls `git.NewTerminalOpener().OpenWorktree(path)`
  - Shows success feedback when terminal opens successfully
  - Shows info feedback with cd command when terminal opening fails (fallback)
  - Shows error feedback if worktree path doesn't exist
  - Updated "cd" action to show the cd command using `git.GetCDCommand()`

**Verification Steps Passed**:
- [x] Action to 'switch' or 'open' worktree exists (Open action in action menu)
- [x] Opens new terminal/shell at worktree path OR prints cd command
- [x] User ends up in correct directory (via terminal or cd command)
- [x] Works with common terminal emulators (auto-detection for macOS, Linux, Windows)

**Tests** (terminal_test.go - 17 tests):
- `TestNewTerminalOpener` - verifies constructor
- `TestNewTerminalOpenerWithCmd` - verifies constructor with custom command
- `TestOpenWorktreeInvalidPath` - verifies error for non-existent path
- `TestOpenWorktreeValidPath` - verifies successful result for valid path
- `TestOpenWorktreeResultFields` - verifies result struct fields
- `TestDetectTerminal` - verifies terminal detection returns values
- `TestDetectTerminalWithCustomCmd` - verifies custom command overrides detection
- `TestShellQuote` - table-driven tests for shell quoting
- `TestShellQuoteWithSingleQuotes` - verifies double-quote fallback
- `TestGetCDCommand` - verifies cd command generation
- `TestOpenWorktreeFallbackToCDCommand` - verifies cd command fallback
- `TestBuildMacOSCommand` - macOS-specific command building (skipped on other OS)
- `TestBuildLinuxCommand` - Linux-specific command building
- `TestBuildWindowsCommand` - Windows-specific command building (skipped on other OS)
- `TestDetectMacOSTerminal` - macOS terminal detection (skipped on other OS)
- `TestDetectWindowsTerminal` - Windows terminal detection (skipped on other OS)

**Tests** (app_test.go - 5 new tests):
- `TestAppOpenActionExecuted` - verifies open action shows feedback
- `TestAppOpenActionWithInvalidPath` - verifies error handling for invalid path
- `TestAppCDActionExecuted` - verifies cd action shows path command
- `TestAppOpenActionResultsInFeedback` - verifies open action feedback content
- `TestAppHandleActionExecutedOpen` (updated) - updated to handle new behavior

**Commands**:
```
go build ./cmd/gwt  # Builds successfully
go test ./... -v    # All tests pass
go vet ./...        # No issues
go fmt ./...        # Code formatted
go mod tidy         # Dependencies clean
```

